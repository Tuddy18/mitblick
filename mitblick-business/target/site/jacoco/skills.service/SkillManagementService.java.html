<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SkillManagementService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MitBlick Business</a> &gt; <a href="index.source.html" class="el_package">skills.service</a> &gt; <span class="el_source">SkillManagementService.java</span></div><h1>SkillManagementService.java</h1><pre class="source lang-java linenums">package skills.service;

import exception.BusinessException;
import exception.ExceptionCode;
import skills.dao.SkillAreaPersistenceManager;
import skills.dao.SkillPersistenceManager;
import skills.dto.SkillDTO;
import skills.dto.SkillDTOHelper;
import skills.entities.Skill;
import skills.entities.SkillArea;

import javax.ejb.EJB;
import javax.ejb.Stateless;
import java.util.Optional;

@Stateless
<span class="nc" id="L17">public class SkillManagementService {</span>

    @EJB
    private SkillPersistenceManager skillPersistenceManager;
    @EJB
    private SkillAreaPersistenceManager skillAreaPersistenceManager;

    /**
     * Creats a skill entity using a skill DTO.
     *
     * @param skillDTO skill information
     * @return the skill DTO of the created entity
     * @throws BusinessException
     */
    public SkillDTO createSkill(SkillDTO skillDTO, String skillAreaName) throws BusinessException {
<span class="nc" id="L32">        Optional&lt;SkillArea&gt; skillArea = validateSkillForCreation(skillDTO, skillAreaName);</span>
<span class="nc" id="L33">        Skill skill = SkillDTOHelper.toEntity(skillDTO);</span>
<span class="nc" id="L34">        skillPersistenceManager.create(skill);</span>
<span class="nc" id="L35">        skillArea.get().getSkills().add(skill);</span>
<span class="nc" id="L36">        return SkillDTOHelper.fromEntity(skill);</span>
    }

    private Optional&lt;SkillArea&gt; validateSkillForCreation(SkillDTO skillDTO, String skillAreaName) throws BusinessException {
<span class="nc" id="L40">        Optional&lt;Skill&gt; skillOptional = skillPersistenceManager.getByName(skillDTO.getName());</span>
<span class="nc" id="L41">        Optional&lt;SkillArea&gt; skillAreaOptional = skillAreaPersistenceManager.getByName(skillAreaName);</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">        if (skillOptional.isPresent()) {</span>
<span class="nc" id="L43">            throw new BusinessException(ExceptionCode.SKILL_VALIDATION_EXCEPTION);</span>
        }
<span class="nc bnc" id="L45" title="All 2 branches missed.">        if(!(skillAreaOptional.isPresent()))</span>
<span class="nc" id="L46">            throw new BusinessException(ExceptionCode.SKILL_SKILLAREA_VALIDATION_EXCEPTION);</span>
<span class="nc" id="L47">        return skillAreaOptional;</span>
    }

//    public void validateSkillForUpdate(SkillDTO skillDTO) throws BusinessException {
//        if (!(skillPersistenceManager.getByName(skillDTO.getName()).isPresent()))
//            throw new BusinessException(ExceptionCode.SKILL_VALIDATION_EXCEPTION);
//    }

    public void validateSkillForDelete(SkillDTO skillDTO) throws BusinessException {
<span class="nc bnc" id="L56" title="All 2 branches missed.">        if (!(skillPersistenceManager.getByName(skillDTO.getName()).isPresent()))</span>
<span class="nc" id="L57">            throw new BusinessException(ExceptionCode.SKILL_VALIDATION_EXCEPTION);</span>
<span class="nc" id="L58">    }</span>

    public SkillDTO updateSkill(String oldName, String newName) throws BusinessException {

<span class="nc" id="L62">        Optional&lt;Skill&gt; skillBeforeOptional = skillPersistenceManager.getByName(oldName);</span>

<span class="nc bnc" id="L64" title="All 2 branches missed.">        if (skillBeforeOptional.isPresent()) {</span>
<span class="nc" id="L65">            Skill skillBefore = skillBeforeOptional.get();</span>
<span class="nc" id="L66">            SkillDTO skillDTO = new SkillDTO();</span>
<span class="nc" id="L67">            skillDTO.setName(newName);</span>
<span class="nc" id="L68">            Skill skillAfter = SkillDTOHelper.updateEntityWithDTO(skillBefore, skillDTO);</span>

<span class="nc" id="L70">            skillPersistenceManager.update(skillAfter);</span>

<span class="nc" id="L72">            return skillDTO;</span>
        } else {
<span class="nc" id="L74">            throw new BusinessException(ExceptionCode.SKILL_NOT_FOUND);</span>
        }
    }

    public void deleteSkill(SkillDTO skillDTO) throws BusinessException {
<span class="nc" id="L79">        Optional&lt;Skill&gt; skillBeforeOptional = skillPersistenceManager.getByName(skillDTO.getName());</span>

<span class="nc bnc" id="L81" title="All 2 branches missed.">        if (skillBeforeOptional.isPresent()) {</span>
<span class="nc" id="L82">            Skill skill = skillBeforeOptional.get();</span>

            //Skill skill = SkillDTOHelper.toEntity(skillDTO);
<span class="nc" id="L85">            skillAreaPersistenceManager.deleteSkill(skill);</span>

<span class="nc" id="L87">            skillPersistenceManager.delete(skill);</span>
<span class="nc" id="L88">        } else {</span>
<span class="nc" id="L89">            throw new BusinessException(ExceptionCode.SKILL_NOT_FOUND);</span>
        }
<span class="nc" id="L91">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>